<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ending Signal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #121212; color: #ffffff; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .glass-effect { background-color: rgba(18, 18, 18, 0.85); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); }
        .safe-pb { padding-bottom: env(safe-area-inset-bottom); }
        /* Smooth transition for toggle */
        .toggle-slide { transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bg: { default: '#121212', card: '#1E1E1E', elevated: '#2C2C2C' },
                        primary: { main: '#4F46E5', glow: '#6366F1' },
                        point: { yellow: '#FACC15' },
                        status: { success: '#16A34A', danger: '#DC2626', gray: '#4B5563' },
                        text: { gray: '#A0A0A0', dark: '#555555' }
                    }
                }
            }
        }
    </script>
</head>
<body class="antialiased bg-bg-default text-white min-h-screen">

    <!-- Layer 3: Global Header -->
    <header class="fixed top-0 left-0 right-0 h-[56px] glass-effect z-50 flex justify-between items-center px-4 border-b border-[#2D2D2D]">
        <div id="homeButton" class="flex items-center cursor-pointer gap-1" onclick="window.scrollTo(0,0); location.reload()">
            <h1 class="text-[22px] font-black tracking-tighter text-white">EN</h1>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 text-point-yellow">
                <path fill-rule="evenodd" d="M5.25 9a6.75 6.75 0 0113.5 0v.75c0 2.123.8 4.057 2.118 5.52a.75.75 0 01-.297 1.206c-1.544.57-3.16.99-4.831 1.243a3.75 3.75 0 11-7.48 0 24.585 24.585 0 01-4.831-1.244.75.75 0 01-.298-1.205A8.217 8.217 0 005.25 9.75V9zm4.502 8.9a2.25 2.25 0 104.496 0 25.057 25.057 0 01-4.496 0z" clip-rule="evenodd" />
            </svg>
        </div>
        <div class="flex items-center gap-3">
            <button id="searchButton" class="text-white p-1">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                </svg>
            </button>
            <button id="profileButton" class="text-white p-1">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0012 15.75a7.488 7.488 0 00-5.982 2.975m11.963 0a9 9 0 10-11.963 0m11.963 0A8.966 8.966 0 0112 21a8.966 8.966 0 01-5.982-2.275M15 9.75a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
            </button>
        </div>
    </header>

    <!-- Layer 1: Base Content -->
    <main class="w-full max-w-[480px] mx-auto pt-[56px] pb-[80px] min-h-screen relative">

        <!-- Layer 2: Sticky Filter Container -->
        <div id="stickyFilterContainer" class="sticky top-[56px] z-40 bg-bg-default/95 backdrop-blur-sm transition-all duration-300">
            <!-- L1 Filter (Logos) -->
            <div id="l1FilterContainer" class="hide-scrollbar overflow-x-auto whitespace-nowrap px-4 py-2 flex gap-3 items-center min-h-[60px] hidden"></div>
            <!-- L2 Filter (Tabs) -->
            <div id="l2FilterContainer" class="hide-scrollbar overflow-x-auto whitespace-nowrap px-4 border-b border-[#2D2D2D] flex gap-4 items-center h-[40px] hidden"></div>
            <!-- My Tab Control (Segmented) -->
            <div id="myTabControlContainer" class="px-4 py-2 hidden h-[56px] flex items-center justify-center"></div>
        </div>

        <!-- Content Grid -->
        <div id="contentGridContainer" class="px-4 mt-4 grid gap-3"></div>

        <!-- Pagination / Footer Actions -->
        <div id="paginationContainer" class="px-4 py-6"></div>

        <!-- Status Indicator -->
        <div id="statusIndicator" class="text-center py-20"></div>

    </main>

    <!-- Layer 3: Bottom Navigation -->
    <nav id="bottomNav" class="fixed bottom-0 left-0 right-0 h-[64px] glass-effect border-t border-[#2D2D2D] z-50 safe-pb">
        <div id="bottomNavGrid" class="container mx-auto max-w-[480px] grid grid-cols-5 h-full">
            <!-- JS populated -->
        </div>
    </nav>

    <!-- Modals -->
    <div id="subscribeModal" class="fixed inset-0 z-[100] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" id="modalBackdrop"></div>
        <div class="relative bg-bg-card rounded-2xl p-6 w-full max-w-sm shadow-2xl">
            <h2 class="text-xl font-bold text-white mb-2">ÏôÑÍ≤∞ ÏïåÎ¶º Î∞õÍ∏∞</h2>
            <p id="modalWebtoonTitle" class="text-text-gray text-sm mb-4"></p>
            <input type="email" id="emailInput" placeholder="Ïù¥Î©îÏùº Ï£ºÏÜå" class="w-full bg-bg-elevated text-white rounded-lg p-3 text-sm focus:ring-2 focus:ring-primary-main outline-none mb-2">
            <p id="emailError" class="text-status-danger text-xs h-4 mb-2"></p>
            <div class="flex justify-end gap-2">
                <button id="cancelButton" class="px-4 py-2 rounded-lg bg-[#3a3a3c] text-gray-300 text-sm font-medium">Ï∑®ÏÜå</button>
                <button id="subscribeButton" class="px-4 py-2 rounded-lg bg-primary-main text-white text-sm font-bold">Íµ¨ÎèÖÌïòÍ∏∞</button>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-24 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded-full bg-bg-elevated text-white text-sm opacity-0 transition-opacity duration-300 pointer-events-none z-[110]"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Configuration & Constants ---
            const TABS = {
                webtoon: { label: 'Webtoon', icon: '<path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/>' },
                novel: { label: 'Web Novel', icon: '<path d="M4 6h16v12H4z"/>' },
                ott: { label: 'OTT', icon: '<path d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.1-.9-2-2-2zm0 14H3V5h18v12z"/>' },
                series: { label: 'Series', icon: '<path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H8V4h12v12z"/>' },
                my: { label: 'My', icon: '<path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>' }
            };

            const FILTER_DATA = {
                webtoon: {
                    l1: [
                        { id: 'all', label: 'Ï†ÑÏ≤¥', color: '#555555' },
                        { id: 'naver', label: 'N', color: '#00DC64' },
                        { id: 'kakao', label: 'K', color: '#FACC15' },
                        { id: 'lezhin', label: 'L', color: '#EC1C24' }
                    ],
                    l2: [
                        { id: 'mon', label: 'Mon' }, { id: 'tue', label: 'Tue' }, { id: 'wed', label: 'Wed' },
                        { id: 'thu', label: 'Thu' }, { id: 'fri', label: 'Fri' }, { id: 'sat', label: 'Sat' },
                        { id: 'sun', label: 'Sun' }, { id: 'completed', label: 'Completed' }
                    ]
                },
                novel: {
                    l1: [
                        { id: 'all', label: 'Ï†ÑÏ≤¥', color: '#555555' },
                        { id: 'naver', label: 'N', color: '#00DC64' },
                        { id: 'kakao', label: 'P', color: '#FACC15' },
                        { id: 'ridi', label: 'R', color: '#0077FF' }
                    ],
                    l2: [
                        { id: 'ranking', label: 'Ranking' }, { id: 'new', label: 'New' }, { id: 'completed', label: 'Completed' }
                    ]
                },
                ott: {
                    l1: [
                        { id: 'all', label: 'Ï†ÑÏ≤¥', color: '#555555' },
                        { id: 'netflix', label: 'N', color: '#E50914' },
                        { id: 'disney', label: 'D', color: '#113CCF' },
                        { id: 'tving', label: 'T', color: '#FF143C' }
                    ],
                    l2: [
                        { id: 'all', label: 'All' }, { id: 'action', label: 'Action' }, { id: 'romance', label: 'Romance' },
                        { id: 'thriller', label: 'Thriller' }
                    ]
                },
                series: {
                    l1: [], // No L1
                    l2: [
                        { id: 'latest', label: 'Latest' }, { id: 'alpha', label: 'Alpha' }
                    ]
                },
                my: {
                    l1: [], l2: [] // Custom Control
                }
            };

            const GRID_CONFIG = {
                webtoon: { cols: 'grid-cols-3', aspect: 'aspect-[3/4]' },
                novel: { cols: 'grid-cols-3', aspect: 'aspect-[1/1.45]' },
                ott: { cols: 'grid-cols-3', aspect: 'aspect-[2/3]' },
                series: { cols: 'grid-cols-3', aspect: 'aspect-[3/4]' },
                my: { cols: 'grid-cols-3', aspect: 'aspect-[3/4]' }
            };

            const state = {
                activeTab: 'webtoon',
                filters: {
                    webtoon: { provider: 'all', day: 'mon' },
                    novel: { provider: 'all', sort: 'ranking' },
                    ott: { provider: 'all', genre: 'all' },
                    series: { sort: 'latest' },
                    my: { viewMode: 'subscribing' }
                },
                contents: { webtoon: {}, novel: {}, ott: {}, series: {}, my: {} },
                isLoading: false,
                currentModal: null
            };

            // UI References
            const UI = {
                bottomNavGrid: document.getElementById('bottomNavGrid'),
                l1FilterContainer: document.getElementById('l1FilterContainer'),
                l2FilterContainer: document.getElementById('l2FilterContainer'),
                myTabControlContainer: document.getElementById('myTabControlContainer'),
                contentGridContainer: document.getElementById('contentGridContainer'),
                paginationContainer: document.getElementById('paginationContainer'),
                statusIndicator: document.getElementById('statusIndicator'),
                modal: document.getElementById('subscribeModal'),
                modalBackdrop: document.getElementById('modalBackdrop'),
                modalWebtoonTitle: document.getElementById('modalWebtoonTitle'),
                emailInput: document.getElementById('emailInput'),
                emailError: document.getElementById('emailError'),
                subscribeButton: document.getElementById('subscribeButton'),
                cancelButton: document.getElementById('cancelButton'),
                toast: document.getElementById('toast'),
                homeButton: document.getElementById('homeButton'),
                searchButton: document.getElementById('searchButton')
            };

            // --- Initialization ---
            function initialize() {
                renderBottomNav();
                updateUI(); // Initial render

                // Event Listeners for Modal
                UI.cancelButton.onclick = closeModal;
                UI.modalBackdrop.onclick = closeModal;
                UI.subscribeButton.onclick = handleSubscribe;
                UI.searchButton.onclick = () => showToast('Í≤ÄÏÉâ Í∏∞Îä• Ï§ÄÎπÑÏ§ëÏûÖÎãàÎã§.'); // Temporary
            }

            // --- Core Logic ---
            async function updateUI() {
                renderFilters();
                renderContentGrid(); // Render skeleton or existing data

                // Fetch data if needed
                if (shouldFetchData()) {
                    await fetchData();
                }

                renderContentGrid(); // Re-render with data
            }

            function shouldFetchData() {
                // Implement caching logic later if needed
                return true;
            }

            async function fetchData() {
                state.isLoading = true;
                UI.statusIndicator.innerHTML = '<div class="text-primary-main text-sm">Loading...</div>';

                const { activeTab } = state;
                const filter = state.filters[activeTab];

                try {
                    // For now, only Webtoon has real API. Others are dummy.
                    if (activeTab === 'webtoon') {
                        let url = '';
                        if (filter.day === 'completed') {
                            url = `/api/contents/completed?type=webtoon&source=${filter.provider}`;
                        } else if (filter.day === 'hiatus') {
                             url = `/api/contents/hiatus?type=webtoon&source=${filter.provider}`;
                        } else {
                            url = `/api/contents/ongoing?type=webtoon&source=${filter.provider}`;
                        }

                        const res = await fetch(url);
                        if (!res.ok) throw new Error('API Error');
                        const data = await res.json();

                        // Structure data for renderer
                        if (filter.day === 'completed' || filter.day === 'hiatus') {
                             state.contents.webtoon[getKey()] = data.contents;
                        } else {
                             state.contents.webtoon[getKey()] = data[filter.day] || [];
                        }
                    } else {
                        // Dummy Data Generation for other tabs
                        await new Promise(r => setTimeout(r, 500)); // Simulate delay
                        state.contents[activeTab][getKey()] = generateDummyData(activeTab);
                    }
                } catch (e) {
                    console.error(e);
                    UI.statusIndicator.innerHTML = '<p class="text-status-danger text-sm">Failed to load</p>';
                } finally {
                    state.isLoading = false;
                    UI.statusIndicator.innerHTML = '';
                }
            }

            function getKey() {
                const f = state.filters[state.activeTab];
                return Object.values(f).join('_');
            }

            function generateDummyData(type) {
                const count = 12;
                return Array.from({length: count}).map((_, i) => ({
                    content_id: `dummy-${i}`,
                    title: `${type.toUpperCase()} Title ${i+1}`,
                    status: i % 3 === 0 ? 'ÏôÑÍ≤∞' : (i % 4 === 0 ? 'Ìú¥Ïû¨' : 'Ïó∞Ïû¨Ï§ë'),
                    meta: { common: { thumbnail_url: `https://via.placeholder.com/300x400/2C2C2C/555?text=${type}` } }
                }));
            }

            // --- Rendering ---
            function renderBottomNav() {
                UI.bottomNavGrid.innerHTML = '';
                Object.keys(TABS).forEach(tabId => {
                    const btn = document.createElement('button');
                    const isActive = state.activeTab === tabId;
                    btn.className = `flex flex-col items-center justify-center w-full h-full transition-all duration-200 ${isActive ? 'text-white' : 'text-text-dark'}`;
                    btn.innerHTML = `
                        <svg class="w-6 h-6 mb-1 ${isActive ? 'scale-110 text-primary-main' : ''} transition-transform" fill="currentColor" viewBox="0 0 24 24">${TABS[tabId].icon}</svg>
                        <span class="text-[10px] ${isActive ? 'font-bold' : 'font-medium'}">${TABS[tabId].label}</span>
                    `;
                    btn.onclick = () => {
                        state.activeTab = tabId;
                        window.scrollTo(0,0);
                        updateUI();
                        renderBottomNav();
                    };
                    UI.bottomNavGrid.appendChild(btn);
                });
            }

            function renderFilters() {
                const { activeTab } = state;
                const filters = FILTER_DATA[activeTab];
                const currentFilters = state.filters[activeTab];

                // L1 Filter
                if (activeTab === 'series' || activeTab === 'my') {
                    UI.l1FilterContainer.classList.add('hidden');
                } else {
                    UI.l1FilterContainer.classList.remove('hidden');
                    UI.l1FilterContainer.innerHTML = '';
                    filters.l1.forEach(item => {
                        const btn = document.createElement('div');
                        const isActive = currentFilters.provider === item.id;
                        btn.className = `flex-shrink-0 w-[42px] h-[42px] rounded-full flex items-center justify-center cursor-pointer transition-all duration-300 ${isActive ? 'ring-2 ring-primary-main opacity-100' : 'opacity-50 grayscale'}`;
                        btn.style.backgroundColor = '#2C2C2C'; // elevated bg
                        btn.innerHTML = `<span class="font-black text-sm" style="color:${item.color}">${item.label}</span>`;
                        btn.onclick = () => {
                            state.filters[activeTab].provider = item.id;
                            renderFilters();
                            updateUI();
                        };
                        UI.l1FilterContainer.appendChild(btn);
                    });
                }

                // L2 Filter
                if (activeTab === 'my') {
                     UI.l2FilterContainer.classList.add('hidden');
                     UI.myTabControlContainer.classList.remove('hidden');
                     renderMyTabControl();
                } else {
                    UI.myTabControlContainer.classList.add('hidden');
                    UI.l2FilterContainer.classList.remove('hidden');
                    UI.l2FilterContainer.innerHTML = '';

                    filters.l2.forEach(item => {
                        const btn = document.createElement('button');
                        // Find active key (day, sort, genre)
                        const activeKey = currentFilters.day || currentFilters.sort || currentFilters.genre;
                        const isActive = activeKey === item.id;

                        btn.className = `px-1 h-full flex items-center text-sm font-medium transition-colors border-b-2 ${isActive ? 'text-white border-primary-main font-bold' : 'text-text-gray border-transparent hover:text-white'}`;
                        btn.textContent = item.label;

                        btn.onclick = () => {
                            if (currentFilters.day) state.filters[activeTab].day = item.id;
                            else if (currentFilters.sort) state.filters[activeTab].sort = item.id;
                            else if (currentFilters.genre) state.filters[activeTab].genre = item.id;

                            renderFilters();
                            updateUI();
                        };
                        UI.l2FilterContainer.appendChild(btn);
                    });
                }
            }

            function renderMyTabControl() {
                UI.myTabControlContainer.innerHTML = '';
                const container = document.createElement('div');
                container.className = 'w-full h-[40px] bg-bg-card rounded-lg relative flex p-1 cursor-pointer';

                const currentMode = state.filters.my.viewMode;
                const isSub = currentMode === 'subscribing';

                // Background slider
                const slider = document.createElement('div');
                slider.className = `absolute top-1 bottom-1 w-[calc(50%-4px)] bg-bg-elevated rounded md:rounded-md transition-transform duration-300 ${isSub ? 'translate-x-0' : 'translate-x-full left-[4px]'}`;
                container.appendChild(slider);

                const btn1 = document.createElement('div');
                btn1.className = `flex-1 z-10 flex items-center justify-center text-sm font-bold transition-colors ${isSub ? 'text-white' : 'text-text-gray'}`;
                btn1.textContent = 'Íµ¨ÎèÖÏ§ë';
                btn1.onclick = () => { state.filters.my.viewMode = 'subscribing'; renderMyTabControl(); updateUI(); };

                const btn2 = document.createElement('div');
                btn2.className = `flex-1 z-10 flex items-center justify-center text-sm font-bold transition-colors ${!isSub ? 'text-white' : 'text-text-gray'}`;
                btn2.textContent = 'ÏµúÍ∑º Î≥∏';
                btn2.onclick = () => { state.filters.my.viewMode = 'completed'; renderMyTabControl(); updateUI(); };

                container.appendChild(btn1);
                container.appendChild(btn2);
                UI.myTabControlContainer.appendChild(container);
            }

            function renderContentGrid() {
                const { activeTab } = state;
                const gridClass = GRID_CONFIG[activeTab].cols;
                UI.contentGridContainer.className = `px-4 mt-4 grid gap-3 ${gridClass}`;
                UI.contentGridContainer.innerHTML = '';
                UI.paginationContainer.innerHTML = '';

                const data = state.contents[activeTab][getKey()] || [];

                if (data.length === 0 && !state.isLoading) {
                     UI.contentGridContainer.innerHTML = '<div class="col-span-3 text-center py-20 text-text-gray text-sm">ÏΩòÌÖêÏ∏†Í∞Ä ÏóÜÏäµÎãàÎã§.</div>';
                } else {
                    data.forEach(content => {
                        UI.contentGridContainer.appendChild(createContentCard(content, activeTab));
                    });
                }

                // Series Footer Button
                if (activeTab === 'series') {
                    const footerBtn = document.createElement('button');
                    footerBtn.className = 'w-full h-[56px] mt-6 bg-bg-card border border-dashed border-text-dark rounded-xl text-text-gray text-sm font-medium hover:bg-bg-elevated hover:text-white transition-colors flex items-center justify-center';
                    footerBtn.textContent = '(+) ÎãπÏã†Ïùò ÏãúÎ¶¨Ï¶àÎ•º Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî';
                    footerBtn.onclick = () => window.open('https://forms.gle/HHhRRxZdE8g4x6nm9', '_blank');
                    UI.paginationContainer.appendChild(footerBtn);
                }
            }

            function createContentCard(content, tab) {
                const card = document.createElement('div');
                card.className = 'relative group cursor-pointer flex flex-col';

                const aspectClass = GRID_CONFIG[tab].aspect;
                const thumbnailUrl = content.meta?.common?.thumbnail_url || 'https://via.placeholder.com/300x400/2C2C2C/555?text=No+Img';

                // Badge Logic
                let badgeHtml = '';
                if (content.status === 'ÏôÑÍ≤∞') badgeHtml = `<span class="absolute top-1 left-1 bg-status-success text-white text-[9px] font-black px-1.5 py-0.5 rounded">ÏôÑÍ≤∞</span>`;
                else if (content.status === 'Ìú¥Ïû¨') badgeHtml = `<span class="absolute top-1 left-1 bg-status-gray text-white text-[9px] font-black px-1.5 py-0.5 rounded">Ìú¥Ïû¨</span>`;
                // Add UP logic if data has updated_at check or similar. Skipping for now as mostly status driven.

                // My Tab Bell Toggle
                let bellOverlay = '';
                if (tab === 'my') {
                     bellOverlay = `
                        <div class="absolute top-1 right-1 bg-black/60 backdrop-blur px-2 py-1 rounded-full flex items-center gap-1 z-20" onclick="event.stopPropagation(); toggleSubscribe('${content.content_id}')">
                            <span class="text-[10px] text-point-yellow">üîî</span>
                            <span class="text-[9px] text-white font-bold">ON</span>
                        </div>
                     `;
                }

                card.innerHTML = `
                    <div class="${aspectClass} rounded-lg overflow-hidden bg-bg-card relative mb-2">
                        <img src="${thumbnailUrl}" alt="${content.title}" loading="lazy" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-60"></div>
                        ${badgeHtml}
                        ${bellOverlay}
                    </div>
                    <div class="px-0.5">
                        <h3 class="text-[13px] font-bold text-white truncate leading-tight">${content.title}</h3>
                        <p class="text-[11px] font-medium text-text-gray truncate mt-1">${content.meta?.common?.authors?.join(', ') || 'Unknown'}</p>
                    </div>
                `;

                card.onclick = () => openModal(content);
                return card;
            }

            // --- Modal & Actions ---
            function openModal(content) {
                state.currentModal = content;
                UI.modalWebtoonTitle.textContent = content.title;
                UI.modal.classList.remove('hidden');
                UI.emailInput.value = localStorage.getItem('user_email') || '';
                UI.emailError.textContent = '';
            }

            function closeModal() {
                UI.modal.classList.add('hidden');
                state.currentModal = null;
            }

            async function handleSubscribe() {
                const email = UI.emailInput.value.trim();
                if (!email || !email.includes('@')) {
                    UI.emailError.textContent = 'Ïú†Ìö®Ìïú Ïù¥Î©îÏùºÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.';
                    return;
                }
                localStorage.setItem('user_email', email); // Save for later

                // TODO: Actual API call
                showToast('Íµ¨ÎèÖ Ïã†Ï≤≠Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.');
                closeModal();
            }

            function toggleSubscribe(id) {
                showToast('Íµ¨ÎèÖ ÏÉÅÌÉúÍ∞Ä Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§.');
            }

            function showToast(msg) {
                UI.toast.textContent = msg;
                UI.toast.classList.remove('opacity-0');
                UI.toast.classList.add('opacity-100');
                setTimeout(() => {
                    UI.toast.classList.remove('opacity-100');
                    UI.toast.classList.add('opacity-0');
                }, 2000);
            }

            initialize();
        });
    </script>
</body>
</html>